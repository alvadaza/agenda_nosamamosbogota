<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#2196f3" />
    <title>Agenda - Login</title>
    <link
      rel="shortcut icon"
      href="./assets/1682980073966-thumbnail-removebg-preview-removebg.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="css/login.css" />
  </head>
  <body>
    <header>
      <img
        src="./assets/1682980073966-thumbnail-removebg-preview-removebg.png"
        alt="Logo Nossamamos Bogotá"
      />
      <h1>NOSSAMAMOSBOGOTA</h1>
      <p>SANDRA NOSSA</p>
    </header>

    <main class="centered">
      <div class="card">
        <h1>Agenda</h1>
        <label>Email</label>
        <input id="email" type="email" placeholder="correo@ejemplo.com" />
        <label>Contraseña</label>
        <div class="input-group">
          <input id="password" type="password" placeholder="contraseña" />
          <button type="button" id="togglePass" class="toggle-pass">👁️</button>
        </div>
        <div class="row">
          <button id="loginBtn">Iniciar sesión</button>
          <button id="signupBtn">Crear cuenta</button>
        </div>
        <p id="msg" class="muted"></p>
      </div>
    </main>
    <!-- Modal de instalación -->
    <div id="install-modal" style="display: none">
      <div id="overlay"></div>
      <div id="install-box">
        <p>¿Deseas instalar la aplicación?</p>
        <button id="install-btn">📲 Instalar Aplicación</button>
        <button id="cancel-install" class="cancel">✖ Cerrar</button>
      </div>
    </div>

    <script type="module" src="js/auth.js"></script>
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("service-worker.js")
          .then((reg) => console.log("Service Worker registrado", reg))
          .catch((err) => console.error("Error al registrar el SW", err));
      }
    </script>
    <script>
      let deferredPrompt;
      const installModal = document.getElementById("install-modal");
      const installBtn = document.getElementById("install-btn");
      const cancelBtn = document.getElementById("cancel-install");

      const isStandalone =
        window.matchMedia("(display-mode: standalone)").matches ||
        window.navigator.standalone === true;

      if (isStandalone) {
        installModal.style.display = "none";
      }

      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;

        if (!isStandalone) {
          // Muestra el modal flotante
          installModal.style.display = "block";
        }

        installBtn.addEventListener("click", () => {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === "accepted") {
              console.log("✅ Usuario aceptó instalar");
            } else {
              console.log("❌ Usuario rechazó la instalación");
            }
            deferredPrompt = null;
            installModal.style.display = "none";
          });
        });

        cancelBtn.addEventListener("click", () => {
          installModal.style.display = "none";
        });
      });

      window.addEventListener("appinstalled", () => {
        console.log("✅ App instalada");
        installModal.style.display = "none";
      });
    </script>
  </body>
</html>
